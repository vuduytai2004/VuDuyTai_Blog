---
title: "Làm cách nào để định kiểu mạnh mẽ cho process.env"
description: "Tìm hiểu cách định kiểu mạnh mẽ cho process.env trong Typescript bằng cách tăng cường kiểu toàn cục hoặc validate nó khi chạy bằng t3-env."
image: "/images/blog/how-to-type-env.webp"
date: "2024-05-30"
author: "devbertskie"
---

Một vấn đề phổ biến trong TypeScript là `process.env` không cung cấp cho bạn tự động hoàn thành (autocomplete) cho các biến môi trường thực sự tồn tại trong hệ thống của bạn:

```ts
console.log(process.env.MY_ENV_VARIABLE); // Không có autocomplete
```

Chúng cũng kết thúc được định kiểu là `string | undefined`, điều này có thể gây khó chịu nếu bạn đang truyền chúng vào các hàm mong đợi một chuỗi:

```ts
const myFunc = (envVar: string) => {
  console.log(envVar.toUpperCase());
};

myFunc(process.env.MY_ENV_VARIABLE);
```

Dưới đây là một vài cách để định kiểu mạnh mẽ cho `process.env`:

## Giải pháp 1: Tăng cường (Augment) Typescript Toàn cục

Bạn có thể tăng cường kiểu toàn cục `NodeJS.ProcessEnv` để bao gồm các biến môi trường của bạn:

```ts
// globals.d.ts
namespace NodeJS {
  interface ProcessEnv {
    MY_ENV_VARIABLE: string;
  }
}
```

Điều này dựa trên việc hợp nhất khai báo (declaration merging) trên interface toàn cục `NodeJS.ProcessEnv`, thêm một thuộc tính bổ sung `MY_ENV_VARIABLE`.

```ts
myFunc(process.env.MY_ENV_VARIABLE);
```

Tuy nhiên, điều này không cung cấp bất kỳ đảm bảo nào rằng biến môi trường thực sự tồn tại trong hệ thống của bạn.

Điều này có nghĩa là nó hữu ích khi bạn có tương đối ít biến môi trường, hoặc không thể thuyết phục việc thêm một thư viện bổ sung để kiểm tra chúng.

## Giải pháp 2: Validate nó khi chạy với `t3-env`

Nếu bạn muốn xác thực rằng tất cả các biến môi trường của bạn đều hiện diện khi chạy (runtime), bạn có thể sử dụng một thư viện như `t3-env`.

Điều này tận dụng `zod` để xác thực các biến môi trường của bạn khi chạy. Đây là một ví dụ:

```js
import { createEnv } from "@t3-oss/env-core";
import { z } from "zod";

export const env = createEnv({
  server: {
    DATABASE_URL: z.string().url(),
    OPEN_AI_API_KEY: z.string().min(1),
  },
  clientPrefix: "PUBLIC_",
  client: {
    PUBLIC_CLERK_PUBLISHABLE_KEY: z.string().min(1),
  },
  runtimeEnv: process.env,
});
```

Điều này sẽ thất bại khi chạy nếu bất kỳ biến môi trường nào bị thiếu hoặc không khớp với schema. Nó cũng có nghĩa là bạn có thể tận dụng khả năng xác thực mạnh mẽ của Zod, chẳng hạn như `.url()` hoặc `.min(1)` cho chuỗi.

Nó cũng cung cấp một nguồn sự thật duy nhất cho các biến môi trường của bạn - `env`. Điều này có nghĩa là bạn có thể sử dụng `env` trong toàn bộ codebase của mình, và bạn sẽ nhận được tự động hoàn thành và kiểm tra kiểu cho các biến môi trường của mình.

Đây là một [hướng dẫn tuyệt vời](https://env.t3.gg/docs/core) bạn có thể sử dụng để bắt đầu.

## Giải pháp nào bạn nên sử dụng?

Nếu dự án của bạn nhỏ và bạn không muốn thêm các phụ thuộc bổ sung, việc tăng cường kiểu toàn cục là một giải pháp tốt.

Nhưng nếu bạn có chút lo lắng về việc thiếu các biến môi trường khi chạy, `t3-env` là một lựa chọn tuyệt vời.
