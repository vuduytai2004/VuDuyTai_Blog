---
title: "Mẫu này sẽ phá hỏng Hiệu suất TS của Ứng dụng React của bạn"
description: "Cải thiện hiệu suất React Typescript bằng cách thay thế type & bằng interface extends. Tăng tốc độ IDE và tsc đáng kể"
image: "/images/blog/extends.webp"
date: "2024-05-30"
author: "devbertskie"
---

Vài năm trước, Sentry đã gặp vấn đề lớn với ứng dụng React của họ. Họ đã [chuyển đổi khá gần đây sang TypeScript](https://blog.sentry.io/slow-and-steady-converting-sentrys-entire-frontend-to-typescript) từ JavaScript. Và ứng dụng là một phần của một monorepo lớn.

Nhưng hiệu suất IDE rất chậm. Bạn thường phải đợi vài giây sau khi thực hiện thay đổi để TypeScript language server cập nhật. Và việc chạy `tsc` sẽ mất nhiều thời gian.

Bây giờ, điều này không phải là bất thường đối với một codebase TypeScript lớn. Nhưng nhóm Sentry đã có linh cảm rằng có điều gì đó không ổn. Vấn đề cảm thấy không tương xứng với kích thước của codebase.

Hóa ra vấn đề, được phác thảo bởi [Jonas](https://twitter.com/JonasBadalic/status/1765006152150974919), là do một pattern duy nhất.

## Cách làm hỏng Hiệu suất TS của Ứng dụng React của bạn

Ở hàng tấn nơi trong codebase của Sentry, họ đã mở rộng các kiểu HTML trong React. Ví dụ, việc xác định `ButtonProps` sẽ trông như thế này:

```ts
import React from "react";

type ButtonProps =
  React.HTMLAttributes<HTMLButtonElement> & {
    extraProp: string;
  };

const Button = ({ extraProp, ...props }: ButtonProps) => {
  console.log(extraProp);
  return <button {...props} />;
};
```

Điều này có nghĩa là bạn có thể truyền vào tất cả các props mà một phần tử `<button>` có thể nhận, cộng với một `extraProp`:

```ts
<Button
  extraProp="whatever"
  onClick={(e) => {

(parameter) e: React.MouseEvent<HTMLButtonElement, MouseEvent>
  }}
/>;
```

Nhưng hóa ra pattern này chậm khủng khiếp. Vì vậy Jonas, làm theo lời khuyên của [TypeScript Performance Wiki](https://github.com/microsoft/TypeScript/wiki/Performance), đã thay đổi mỗi cái này để sử dụng một `interface` thay thế:

```ts
import React from "react";

interface ButtonProps extends React.HTMLAttributes<HTMLButtonElement> {
  extraProp: string;
}
```

Đột nhiên, mọi thứ trở nên nhanh hơn nhiều. TypeScript language server nhanh hơn, và tsc chạy nhanh hơn. Chỉ từ một thay đổi cú pháp nhỏ. Tại sao?

## Tại sao điều này xảy ra

Bạn có thể đã nghe nói rằng `interface` nhanh hơn một chút so với `type`. Điều này không hoàn toàn đúng. Trên thực tế, `interface extends` nhanh hơn một chút so với `&`.

Trong một phiên bản trước của bài viết này, tôi đã đăng một lời giải thích dựa trên một số suy nghĩ mơ hồ mà, nhờ đồng nghiệp cũ của tôi [Mateusz Burzyński](https://twitter.com/AndaristRake), bây giờ tôi hiểu là sai.

Vấn đề phức tạp hơn tôi nhận ra - hãy xem [luồng này](https://twitter.com/AndaristRake/status/1770743549325115459) để biết những lời phê bình và điều tra của chúng tôi.

Hy vọng rằng, tôi có thể cập nhật bài viết này một lần nữa với mô tả dứt khoát về lý do tại sao điều này xảy ra - nhưng không có gì là đơn giản khi nói đến hiệu suất TypeScript.

Chỉ cần nói rằng - `interface extends` thường nhanh hơn `&`, và vì vậy nó cũng được chứng minh trong trường hợp này.
