---
title: "Thành thạo Java Streams API: Hướng dẫn toàn diện"
description: "Đi sâu vào Java Streams API, bao gồm các hoạt động trung gian và đầu cuối, các luồng song song và các phương pháp hay nhất cho lập trình hàm trong Java."
image: "/images/blog/java-streams-api.png"
date: "2025-12-24"
author: "Tai Vu"
---

# Thành thạo Java Streams API: Hướng dẫn toàn diện

Java Streams API, được giới thiệu trong Java 8, đã cách mạng hóa cách các nhà phát triển xử lý các tập hợp dữ liệu. Nó cho phép tiếp cận khai báo để xử lý dữ liệu, giúp bạn viết code ngắn gọn, dễ đọc và hiệu quả. Trong hướng dẫn toàn diện này, chúng ta sẽ khám phá chiều sâu của Streams API, từ các hoạt động cơ bản đến xử lý song song nâng cao.

## Stream là gì?

Một `Stream` trong Java là một chuỗi các phần tử hỗ trợ các hoạt động tổng hợp tuần tự và song song. Không giống như các collection, stream không lưu trữ dữ liệu; thay vào đó, chúng truyền tải các phần tử từ một nguồn—chẳng hạn như cấu trúc dữ liệu, mảng hoặc kênh I/O—qua một đường ống các hoạt động tính toán.

### Các đặc điểm chính của Streams:
1.  **Tính khai báo**: Bạn chỉ định *những gì* bạn muốn làm (ví dụ: lọc, ánh xạ, sắp xếp) thay vì *cách* làm (vòng lặp và câu lệnh if).
2.  **Pipelining (Đường ống)**: Nhiều hoạt động stream trả về chính stream đó, cho phép các hoạt động được nối chuỗi để tạo thành một đường ống lớn hơn.
3.  **Laziness (Lười biếng)**: Các hoạt động trung gian (như `filter` hoặc `map`) không được thực thi cho đến khi một hoạt động đầu cuối (như `collect` hoặc `forEach`) được gọi.
4.  **Có thể song song hóa**: Streams có thể dễ dàng song song hóa các hoạt động mà không yêu cầu nhà phát triển phải viết code đa luồng.

## Tạo Streams

Streams có thể được tạo từ nhiều nguồn khác nhau. Đây là những cách phổ biến nhất:

```java
// Từ một List
List<String> list = Arrays.asList("a", "b", "c");
Stream<String> streamFromList = list.stream();

// Từ một Mảng
String[] arr = {"a", "b", "c"};
Stream<String> streamFromArray = Arrays.stream(arr);

// Trực tiếp sử dụng Stream.of()
Stream<String> streamOf = Stream.of("a", "b", "c");

// Stream vô hạn (sử dụng limit!)
Stream<Double> randoms = Stream.generate(Math::random).limit(10);
```

## Các hoạt động trung gian

Các hoạt động trung gian biến đổi một stream thành một stream khác. Chúng lười biếng, nghĩa là chúng không thực thi cho đến khi một hoạt động đầu cuối chạy.

### 1. Filter (Lọc)
Phương thức `filter` chấp nhận một `Predicate` để lọc các phần tử.

```java
List<String> names = Arrays.asList("John", "Jane", "Jack", "Doe");
names.stream()
     .filter(name -> name.startsWith("J"))
     .forEach(System.out::println); // Output: John, Jane, Jack
```

### 2. Map (Ánh xạ)
Phương thức `map` chấp nhận một `Function` để biến đổi từng phần tử.

```java
List<String> names = Arrays.asList("Java", "Kotlin", "Scala");
names.stream()
     .map(String::toUpperCase)
     .forEach(System.out::println);
// Output: JAVA, KOTLIN, SCALA
```

### 3. Sorted (Sắp xếp)
Sắp xếp stream.

```java
names.stream()
     .sorted()
     .forEach(System.out::println);
```

## Các hoạt động đầu cuối

Các hoạt động đầu cuối tạo ra kết quả hoặc tác dụng phụ. Sau khi hoạt động đầu cuối được thực hiện, đường ống stream được coi là đã tiêu thụ và không thể sử dụng lại.

### 1. Collect (Thu thập)
Hoạt động đầu cuối phổ biến nhất, thường được sử dụng để thu thập kết quả vào List, Set hoặc Map.

```java
List<String> upperCaseNames = names.stream()
                                   .map(String::toUpperCase)
                                   .collect(Collectors.toList());
```

### 2. forEach
Lặp qua từng phần tử (chủ yếu cho các tác dụng phụ như in ấn).

```java
names.stream().forEach(System.out::println);
```

### 3. Reduce (Giảm)
Kết hợp các phần tử thành một kết quả duy nhất.

```java
List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);
int sum = numbers.stream().reduce(0, Integer::sum);
// sum is 15
```

## Luồng song song (Parallel Streams)

Một trong những tính năng mạnh mẽ nhất của Streams API là khả năng xử lý dữ liệu song song với nỗ lực tối thiểu. Bằng cách đơn giản thay đổi `stream()` thành `parallelStream()`, JVM chia dữ liệu thành các khối và xử lý chúng trên nhiều luồng.

```java
long count = largeList.parallelStream()
                      .filter(e -> e.isValid())
                      .count();
```

**Cảnh báo**: Parallel streams không phải là viên đạn bạc. Chúng bao gồm chi phí cho việc chia nhỏ và hợp nhất kết quả. Chỉ sử dụng chúng cho các tập dữ liệu lớn hoặc các tác vụ đòi hỏi tính toán cao.

## Thực tiễn tốt nhất và Cạm bẫy

1.  **Không sửa đổi nguồn**: Các hoạt động Stream nên là stateless (không trạng thái) và không can thiệp. Sửa đổi collection cơ bản trong quá trình thực thi dẫn đến `ConcurrentModificationException` hoặc hành vi không xác định.
2.  **Tránh tác dụng phụ**: Cố gắng giữ cho các hoạt động thuần túy. Sử dụng `forEach` để thêm các phần tử vào một danh sách bên ngoài thường là dấu hiệu xấu; hãy sử dụng `collect` thay thế.
3.  **Không thể tái sử dụng**: Hãy nhớ rằng, một Stream chỉ có thể được duyệt một lần. Nếu bạn cần duyệt lại, bạn phải tạo một Stream mới từ nguồn.

## Kết luận

Java Streams API là một công cụ thiết yếu cho bất kỳ nhà phát triển Java hiện đại nào. Nó gói gọn sự phức tạp của việc lặp lại và cho phép bạn diễn đạt các biến đổi dữ liệu phức tạp một cách rõ ràng và ngắn gọn. Làm chủ nó sẽ dẫn đến các ứng dụng sạch hơn, mạnh mẽ hơn và tiềm năng nhanh hơn.
